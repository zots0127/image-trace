import i18n from "i18next";
import { initReactI18next } from "react-i18next";

const STORAGE_KEY = "image-trace-lang";

const detectInitialLng = () => {
  if (typeof window === "undefined") return "zh";
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) return saved;
  const nav = navigator.language || "";
  if (nav.toLowerCase().startsWith("en")) return "en";
  if (nav.toLowerCase().startsWith("zh")) return "zh";
  return "zh";
};

const resources = {
  en: {
    translation: {
      demo: {
        badge: "Free demo",
        title: "Image similarity analysis demo",
        subtitle: "Upload multiple images to try AI-driven similarity analysis.",
        subtitleGuest: "Sign up to unlock batch analysis and full features.",
        uploadTitle: "Upload images",
        uploadDesc: "Drag & drop or click to upload multiple images",
        addMore: "Add more images",
        imageLabel: "Image {{index}}",
        dropHintActive: "Release to upload images",
        dropHintIdle: "Drag images here",
        dropHintSub: "Or click to choose files (PNG, JPG, WEBP)",
        analyze: "Start analysis",
        analyzing: "Analyzing...",
        needMoreTitle: "Please upload images",
        needMoreDesc: "At least 2 images are required for similarity analysis",
        resultTitle: "Analysis result",
        resultDesc: "Similarity between these two images is {{percent}}%",
        similarityHigh: "High similarity",
        similarityMedium: "Medium similarity",
        similarityLow: "Low similarity",
        upgradeTitle: "Unlock full features",
        upgradeDesc: "Sign up to get batch analysis, project management, history, and reports",
        upgradeCta: "Sign up free",
        loggedTitle: "Want to analyze more images?",
        loggedDesc: "Go to dashboard to create a project and run full analysis",
        goDashboard: "Go to dashboard",
      },
      index: {
        title: "Welcome to your blank app",
        subtitle: "Start building your amazing project here!",
      },
      project: {
        loadFailed: "Load failed",
        copyDetail: "Copied error detail",
        notFound: "Project not found",
        backHome: "Back to home",
        back: "Back",
        refresh: "Refresh",
        history: "History runs",
        historyDesc: "Most recent first, click to view result",
        runLoaded: "Loaded historical result",
        runNoResult: "No result data saved for this run",
        runId: "Run #{{id}}",
        groupsCount: "Groups {{count}}",
        uniqueCount: "Uniques {{count}}",
        uploadedTitle: "Uploaded images",
        uploadedCount: "{{count}} images",
        analyzing: "Analyzing images…",
        prefetching: "Loading latest analysis…",
        compareTitle: "Similarity groups ({{groups}} groups, {{unique}} ungrouped)",
        compareDesc: "Total {{total}} images",
        statsTotal: "Total: {{count}}",
        statsGroups: "Groups: {{count}}",
        statsUnique: "Uniques: {{count}}",
        statsAlgo: "Algorithm: {{algo}}",
        statsMatchAlgo: "Match lines:",
        toggleAdvancedShow: "Show advanced view",
        toggleAdvancedHide: "Hide advanced view",
        groupLabel: "Group {{id}}",
        avgSimilarity: "Avg similarity {{percent}}%",
        viewMatches: "View feature lines",
        generating: "Generating...",
        ungrouped: "Ungrouped",
        matchModal: "Feature matches",
        close: "Close",
        viewResult: "View result",
        uploadSection: "Upload files",
        uploadImagesTab: "Upload images",
        uploadDocsTab: "Upload docs to extract images",
        analyzeSuccess: "Analysis finished",
        analyzeSuccessDesc: "{{total}} images, {{groups}} groups",
        analyzeFailed: "Analysis failed",
        loadHistory: "Load history",
        generateMatchFailed: "Failed to generate feature lines",
      },
      notfound: {
        code: "404",
        title: "Oops! Page not found",
        back: "Return to home",
      },
      common: {
        appName: "Image Trace",
        signIn: "Sign In",
        signUp: "Sign Up",
        email: "Email",
        password: "Password",
        or: "OR",
        loginWithGithub: "Sign in with GitHub",
        registerWithGithub: "Sign up with GitHub",
        welcomeBack: "Welcome back!",
        fillAllFields: "Please fill all fields",
        passwordTooShort: "Password too short",
        passwordRequirement: "Password must be at least 6 characters",
        logout: "Sign out",
        offlineMode: "Offline mode: usable without account",
        onlineTip: "Sign in or register to start",
        dashboard: "Dashboard",
        demo: "Demo",
        landingHero: "Trace the digital footprint of images",
        landingSub: "AI-powered image provenance analysis",
        landingCta: "Get started",
        footerRights: "All rights reserved.",
        refresh: "Refresh",
        noProjects: "No projects yet",
        createFirst: "Create your first project to start analysis",
        deleted: "Project deleted",
        deleteDesc: "Project and all data removed",
        deleteFailed: "Delete failed",
        loadFailed: "Load failed",
        loadFailedDesc: "Cannot reach backend service",
        copy: "Copy",
      },
      toast: {
        signInSuccess: "Signed in successfully",
        signUpSuccess: "Sign up succeeded, check verification email",
        signOut: "Signed out",
        offlineSignIn: "Offline sign-in succeeded",
        offlineSignUp: "Offline sign-up succeeded",
        offlineGithub: "Offline GitHub sign-in",
        githubFailed: "GitHub login failed",
      },
    },
  },
  zh: {
    translation: {
          demo: {
            badge: "免费演示",
            title: "图像相似度分析演示",
            subtitle: "上传多张图片，体验 AI 驱动的图像相似度分析。",
            subtitleGuest: "注册账号可解锁批量分析和完整功能。",
            uploadTitle: "上传图片",
            uploadDesc: "拖放或点击上传，支持多张图片",
            addMore: "继续添加图片",
            imageLabel: "图片 {{index}}",
            dropHintActive: "释放以上传图片",
            dropHintIdle: "拖放图片到此处",
            dropHintSub: "或点击选择文件（支持 PNG, JPG, WEBP）",
            analyze: "开始分析",
            analyzing: "分析中...",
            needMoreTitle: "请上传图片",
            needMoreDesc: "需要至少2张图片才能进行相似度分析",
            resultTitle: "分析结果",
            resultDesc: "这两张图片的相似度为 {{percent}}%",
            similarityHigh: "高度相似",
            similarityMedium: "中度相似",
            similarityLow: "低相似度",
            upgradeTitle: "解锁完整功能",
            upgradeDesc: "注册账号后可享受批量图片分析、项目管理、历史记录保存、详细报告导出等完整功能",
            upgradeCta: "免费注册",
            loggedTitle: "想要分析更多图片？",
            loggedDesc: "前往控制台创建项目，批量上传图片进行完整的溯源分析",
            goDashboard: "进入控制台",
          },
      index: {
        title: "欢迎来到你的空白应用",
        subtitle: "从这里开始构建你的精彩项目！",
      },
      project: {
        loadFailed: "加载失败",
        copyDetail: "已复制错误详情",
        notFound: "项目未找到",
        backHome: "返回首页",
        back: "返回",
        refresh: "刷新",
        history: "历史分析",
        historyDesc: "按时间倒序，点击可查看对应结果",
        runLoaded: "已加载历史结果",
        runNoResult: "无结果数据",
        runId: "运行 #{{id}}",
        groupsCount: "分组 {{count}}",
        uniqueCount: "未分组 {{count}}",
        uploadedTitle: "已上传图片",
        uploadedCount: "{{count}} 张",
        analyzing: "正在分析图片，请稍候…",
        prefetching: "正在加载最新分析结果…",
        compareTitle: "相似分组（{{groups}} 组，未分组 {{unique}} 张）",
        compareDesc: "共 {{total}} 张图片",
        statsTotal: "总图片：{{count}}",
        statsGroups: "分组：{{count}}",
        statsUnique: "未分组：{{count}}",
        statsAlgo: "算法：{{algo}}",
        statsMatchAlgo: "连线算法：",
        toggleAdvancedShow: "显示高级视图",
        toggleAdvancedHide: "隐藏高级视图",
        groupLabel: "组 {{id}}",
        avgSimilarity: "平均相似度 {{percent}}%",
        viewMatches: "查看特征连线",
        generating: "生成中...",
        ungrouped: "未分组",
        matchModal: "特征点连线",
        close: "关闭",
        viewResult: "查看结果",
        uploadSection: "上传文件",
        uploadImagesTab: "直接上传图片",
        uploadDocsTab: "上传文档提取图片",
        analyzeSuccess: "分析完成",
        analyzeSuccessDesc: "共 {{total}} 张图片，分组 {{groups}}",
        analyzeFailed: "分析失败",
        loadHistory: "加载历史结果",
        generateMatchFailed: "生成特征连线失败",
      },
      notfound: {
        code: "404",
        title: "抱歉，页面未找到",
        back: "返回首页",
      },
      common: {
        appName: "图像溯源分析系统",
        signIn: "登录",
        signUp: "注册",
        email: "邮箱",
        password: "密码",
        or: "或",
        loginWithGithub: "使用 GitHub 登录",
        registerWithGithub: "使用 GitHub 注册",
        welcomeBack: "欢迎回来！",
        fillAllFields: "请填写所有字段",
        passwordTooShort: "密码过短",
        passwordRequirement: "密码至少需要6个字符",
        logout: "退出登录",
        offlineMode: "离线模式：无需账号可本地使用",
        onlineTip: "登录或注册以开始使用",
        dashboard: "控制台",
        demo: "在线演示",
        landingHero: "追溯图片的数字足迹",
        landingSub: "AI 驱动的图像溯源分析",
        landingCta: "立即体验",
        footerRights: "保留所有权利。",
        refresh: "刷新",
        noProjects: "暂无项目",
        createFirst: "创建您的第一个项目开始分析图片",
        deleted: "项目已删除",
        deleteDesc: "项目及其所有数据已被删除",
        deleteFailed: "删除失败",
        loadFailed: "加载失败",
        loadFailedDesc: "无法连接到后端服务",
        copy: "复制",
      },
      toast: {
        signInSuccess: "登录成功",
        signUpSuccess: "注册成功，请查收验证邮件",
        signOut: "已退出登录",
        offlineSignIn: "离线登录成功",
        offlineSignUp: "离线注册成功",
        offlineGithub: "离线 GitHub 登录",
        githubFailed: "GitHub 登录失败",
      },
    },
  },
};

const fallbackLng = "zh";
const initialLng = detectInitialLng();

i18n.use(initReactI18next).init({
  resources,
  lng: initialLng,
  fallbackLng,
  interpolation: {
    escapeValue: false,
  },
});

if (typeof window !== "undefined") {
  i18n.on("languageChanged", (lng) => {
    try {
      localStorage.setItem(STORAGE_KEY, lng);
    } catch {
      // ignore storage errors
    }
  });
}

export default i18n;
